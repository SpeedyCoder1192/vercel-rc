<!DOCTYPE html>
<html>
<head>
    <title>System RC Web Client</title>
    <style>
        body { margin: 0; background: #222; display: flex; flex-direction: column; align-items: center; color: white; font-family: sans-serif; }
        #remoteVideo { width: 100%; max-width: 400px; border: 2px solid #444; margin-top: 20px; cursor: crosshair; }
        .status { padding: 10px; color: #0f0; }
    </style>
</head>
<body>
    <h2>Remote Device View</h2>
    <div id="status" class="status">Waiting for stream...</div>
    <video id="remoteVideo" autoplay playsinline></video>

    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        const room = "device-1";
        const video = document.getElementById('remoteVideo');
        const peerConnection = new RTCPeerConnection({
            iceServers: [{ urls: 'stun:stun.l.google.com:19302' }]
        });

        socket.emit('join', room);

        // Receive Stream
        peerConnection.ontrack = (event) => {
            video.srcObject = event.streams[0];
            document.getElementById('status').innerText = "Streaming Live";
        };

        // Handle Signaling
        socket.on('signal', async (data) => {
            if (data.type === 'offer') {
                await peerConnection.setRemoteDescription(new RTCSessionDescription(data.signal));
                const answer = await peerConnection.createAnswer();
                await peerConnection.setLocalDescription(answer);
                socket.emit('signal', { room, signal: answer, type: 'answer' });
            } else if (data.type === 'ice') {
                await peerConnection.addIceCandidate(new RTCIceCandidate(data.signal));
            }
        });

        // Capture Clicks and send to Phone
        video.addEventListener('mousedown', (e) => {
            const rect = video.getBoundingClientRect();
            const x = ((e.clientX - rect.left) / rect.width) * 1080; // Scale to phone width
            const y = ((e.clientY - rect.top) / rect.height) * 2400; // Scale to phone height
            socket.emit('command', { type: 'click', x, y, room });
            console.log(`Sent click: ${x}, ${y}`);
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>RC Private Dashboard</title>
    <style>
        body { background: #0f0f0f; color: #00ff00; font-family: 'Courier New', monospace; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        #screen-container { position: relative; border: 2px solid #333; box-shadow: 0 0 20px rgba(0,255,0,0.2); }
        video { width: 360px; height: auto; display: block; background: #000; cursor: crosshair; }
        .status-bar { margin-top: 10px; font-size: 14px; }
    </style>
</head>
<body>
    <h2>SECURE REMOTE ACCESS</h2>
    <div id="screen-container">
        <video id="remoteView" autoplay playsinline></video>
    </div>
    <div class="status-bar">Status: <span id="status">INITIALIZING...</span></div>

    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <script>
        const SECRET = "YourSecretKeyHere";
        const video = document.getElementById('remoteView');
        const statusText = document.getElementById('status');

        // Connect with the required header
        const socket = io({
            extraHeaders: { "ModHeader": SECRET }
        });

        socket.on('connect', () => {
            statusText.innerText = "CONNECTED";
            socket.emit('register', 'controller');
        });

        // Click Handling: Send coordinates to phone
        video.addEventListener('mousedown', (e) => {
            const rect = video.getBoundingClientRect();
            // Maps click to 0.0 - 1.0 scale so it works regardless of phone resolution
            const relX = (e.clientX - rect.left) / rect.width;
            const relY = (e.clientY - rect.top) / rect.height;

            socket.emit('command', {
                type: 'CLICK',
                x: relX,
                y: relY
            });
        });

        // WebRTC Basic Logic
        const pc = new RTCPeerConnection({
            iceServers: [{ urls: 'stun:stun.l.google.com:19302' }]
        });

        pc.ontrack = (event) => { video.srcObject = event.streams[0]; };

        socket.on('signal', async (data) => {
            if (data.sdp) {
                await pc.setRemoteDescription(new RTCSessionDescription(data.sdp));
                if (data.sdp.type === 'offer') {
                    const answer = await pc.createAnswer();
                    await pc.setLocalDescription(answer);
                    socket.emit('signal', { role: 'controller', payload: { sdp: pc.localDescription } });
                }
            } else if (data.candidate) {
                await pc.addIceCandidate(new RTCIceCandidate(data.candidate));
            }
        });
    </script>
</body>
</html>